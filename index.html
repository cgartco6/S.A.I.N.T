<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Crypto Dashboard - Real-Time Data Only</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a1a2e;
            --secondary: #16213e;
            --accent: #0f3460;
            --text: #e6e6e6;
            --profit: #2ecc71;
            --loss: #e74c3c;
            --warning: #f39c12;
            --card-bg: rgba(255, 255, 255, 0.05);
            --header-bg: rgba(0, 0, 0, 0.3);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        header {
            background-color: var(--header-bg);
            padding: 1rem;
            text-align: center;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .app-title {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--profit), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 1rem;
        }
        
        .ticker-container {
            background: rgba(0, 0, 0, 0.4);
            padding: 0.75rem 0;
            overflow: hidden;
            white-space: nowrap;
            position: relative;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .ticker {
            display: inline-block;
            padding-left: 100%;
            animation: ticker-scroll 300s linear infinite;
        }
        
        .ticker-item {
            display: inline-block;
            margin: 0 1.5rem;
            font-size: 0.9rem;
        }
        
        .ticker-symbol {
            font-weight: 700;
            margin-right: 0.25rem;
        }
        
        .ticker-price {
            color: var(--text);
        }
        
        .ticker-change {
            margin-left: 0.5rem;
        }
        
        .positive { color: var(--profit); }
        .negative { color: var(--loss); }
        
        @keyframes ticker-scroll {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100%, 0); }
        }
        
        .main-content {
            flex: 1;
            padding: 1rem;
            width: 100%;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .panels-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .panel {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.2rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--profit);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-title {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .neutral { color: var(--warning); }
        
        .table-container {
            overflow-x: auto;
            margin: 1rem 0;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        th {
            background-color: rgba(0, 0, 0, 0.3);
            font-weight: 600;
            cursor: pointer;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .progress-bar {
            height: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active, .filter-btn:hover {
            background: var(--accent);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--header-bg);
            backdrop-filter: blur(10px);
            position: sticky;
            bottom: 0;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .system-health {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .health-bar {
            width: 80px;
            height: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .badge {
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-green { background-color: var(--profit); color: #000; }
        .badge-red { background-color: var(--loss); }
        .badge-orange { background-color: var(--warning); color: #000; }
        
        .blink {
            animation: blink-animation 1s steps(2, start) infinite;
        }
        
        @keyframes blink-animation {
            to { visibility: hidden; }
        }
        
        .price-update {
            animation: highlight 1s ease;
        }
        
        @keyframes highlight {
            0% { background-color: rgba(46, 204, 113, 0.3); }
            100% { background-color: transparent; }
        }
        
        .crypto-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
            border-radius: 50%;
            vertical-align: middle;
        }
        
        .breakout-prediction {
            border-left: 4px solid var(--profit);
            padding-left: 1rem;
            margin: 1rem 0;
        }
        
        .bearish-prediction {
            border-left: 4px solid var(--loss);
            padding-left: 1rem;
            margin: 1rem 0;
        }
        
        .prediction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }
        
        .prediction-title {
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }
        
        .prediction-confidence {
            font-size: 0.9rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .prediction-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .prediction-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 1rem;
        }
        
        .prediction-card-title {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }
        
        .prediction-card-value {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .ai-thinking {
            font-style: italic;
            opacity: 0.7;
            margin: 0.5rem 0;
        }
        
        .debug-console {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.8rem;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .debug-entry {
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .debug-timestamp {
            color: #888;
            margin-right: 0.5rem;
        }
        
        .debug-info {
            color: #2ecc71;
        }
        
        .debug-warning {
            color: #f39c12;
        }
        
        .debug-error {
            color: #e74c3c;
        }
        
        @media (max-width: 768px) {
            .panels-container {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .app-title {
                font-size: 1.5rem;
            }
            
            .panel {
                padding: 1rem;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
            
            .ticker-item {
                margin: 0 0.75rem;
            }
            
            .prediction-details {
                grid-template-columns: 1fr;
            }
            
            .prediction-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                justify-content: center;
            }
            
            .app-title {
                font-size: 1.3rem;
            }
            
            .ticker-item {
                margin: 0 0.5rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="app-title">Live Crypto Intelligence</h1>
            <p class="app-subtitle">Real-Time Data & Breakout Predictions</p>
        </header>
        
        <div class="ticker-container">
            <div class="ticker" id="crypto-ticker">
                <!-- Ticker items will be populated by JavaScript -->
            </div>
        </div>
        
        <div class="main-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">Market Cap</div>
                    <div class="stat-value neutral" id="total-marketcap">$2.36T</div>
                    <div>Total Crypto</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">24h Volume</div>
                    <div class="stat-value neutral" id="total-volume">$108.4B</div>
                    <div>Global</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">BTC Dominance</div>
                    <div class="stat-value neutral" id="btc-dominance">46.8%</div>
                    <div>Current</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Active Coins</div>
                    <div class="stat-value positive" id="active-coins">12,345</div>
                    <div>Tracked</div>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">Breakout Predictions</h2>
                    <span class="badge badge-green" id="breakout-count">0 predicted</span>
                </div>
                
                <div id="breakout-predictions-container">
                    <div class="ai-thinking">Analyzing real-time market data for breakout patterns...</div>
                </div>
            </div>
            
            <div class="panels-container">
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title">Top Gainers</h2>
                        <span class="badge badge-green" id="gainers-count">0 coins</span>
                    </div>
                    <div class="table-container">
                        <table id="gainers-table">
                            <thead>
                                <tr>
                                    <th data-sort="name">Coin</th>
                                    <th data-sort="price">Price</th>
                                    <th data-sort="change24h">24h %</th>
                                    <th data-sort="volume">Volume (24h)</th>
                                </tr>
                            </thead>
                            <tbody id="gainers-body">
                                <tr><td colspan="4" style="text-align: center;">Loading gainers...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title">Top Losers</h2>
                        <span class="badge badge-red" id="losers-count">0 coins</span>
                    </div>
                    <div class="table-container">
                        <table id="losers-table">
                            <thead>
                                <tr>
                                    <th data-sort="name">Coin</th>
                                    <th data-sort="price">Price</th>
                                    <th data-sort="change24h">24h %</th>
                                    <th data-sort="volume">Volume (24h)</th>
                                </tr>
                            </thead>
                            <tbody id="losers-body">
                                <tr><td colspan="4" style="text-align: center;">Loading losers...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">Monitored Altcoins</h2>
                    <span class="badge badge-orange" id="monitored-count">6 coins</span>
                </div>
                <div class="table-container">
                    <table id="monitored-table">
                        <thead>
                            <tr>
                                <th data-sort="name">Coin</th>
                                <th data-sort="price">Price</th>
                                <th data-sort="change24h">24h %</th>
                                <th data-sort="marketcap">Market Cap</th>
                                <th data-sort="volume">Volume (24h)</th>
                            </tr>
                        </thead>
                        <tbody id="monitored-body">
                            <tr><td colspan="5" style="text-align: center;">Loading monitored coins...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="panels-container">
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title">Market Sentiment</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="sentiment-chart"></canvas>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title">Market Dominance</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="dominance-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">System Health</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">Last Update</div>
                        <div class="stat-value" id="last-update">Just now</div>
                        <div>Timestamp</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Updating In</div>
                        <div class="stat-value neutral" id="update-countdown">60s</div>
                        <div>Next Refresh</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Data Source</div>
                        <div class="stat-value positive" id="data-source">CoinGecko</div>
                        <div>Live API</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">API Status</div>
                        <div class="stat-value positive" id="api-status">Live</div>
                        <div>Connection</div>
                    </div>
                </div>
                <div class="debug-console" id="debug-console">
                    <div class="debug-entry">
                        <span class="debug-timestamp">[12:00:00]</span>
                        <span class="debug-info">System initialized. Connecting to APIs...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="system-health">
                <span>System Health:</span>
                <div class="health-bar">
                    <div class="health-fill" id="health-bar" style="width: 100%; background-color: #2ecc71;"></div>
                </div>
                <span id="health-text">Optimal</span>
            </div>
            <div id="status-message">Loading real-time cryptocurrency data...</div>
            <div id="update-timer" class="blink">Live Updates Enabled</div>
        </div>
    </div>

    <script>
        // Global variables
        let coinData = [];
        let monitoredCoins = ['dogwifhat', 'filecoin', 'bonk', 'cardano', 'monero', 'tron'];
        let sortField = 'market_cap_rank';
        let sortDirection = 'asc';
        let currentFilter = 'all';
        let updateInterval;
        let updateTimer = 60;
        let charts = {
            sentiment: null,
            dominance: null
        };
        let debugEntries = [];
        
        // DOM elements (will be initialized after DOM is loaded)
        let tickerElement, gainersBody, losersBody, monitoredBody, breakoutContainer;
        let debugConsole, healthBar, healthText, statusMessage, updateTimerElement;
        let lastUpdateElement, updateCountdownElement, totalMarketcapElement, totalVolumeElement;
        let btcDominanceElement, activeCoinsElement, dataSourceElement, apiStatusElement;
        let gainersCountElement, losersCountElement, breakoutCountElement, monitoredCountElement;

        // Initialize the application after DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize DOM elements
            initializeDOMElements();
            
            // Start the application
            initializeApp();
        });

        // Initialize DOM elements
        function initializeDOMElements() {
            tickerElement = document.getElementById('crypto-ticker');
            gainersBody = document.getElementById('gainers-body');
            losersBody = document.getElementById('losers-body');
            monitoredBody = document.getElementById('monitored-body');
            breakoutContainer = document.getElementById('breakout-predictions-container');
            debugConsole = document.getElementById('debug-console');
            healthBar = document.getElementById('health-bar');
            healthText = document.getElementById('health-text');
            statusMessage = document.getElementById('status-message');
            updateTimerElement = document.getElementById('update-timer');
            lastUpdateElement = document.getElementById('last-update');
            updateCountdownElement = document.getElementById('update-countdown');
            totalMarketcapElement = document.getElementById('total-marketcap');
            totalVolumeElement = document.getElementById('total-volume');
            btcDominanceElement = document.getElementById('btc-dominance');
            activeCoinsElement = document.getElementById('active-coins');
            dataSourceElement = document.getElementById('data-source');
            apiStatusElement = document.getElementById('api-status');
            gainersCountElement = document.getElementById('gainers-count');
            losersCountElement = document.getElementById('losers-count');
            breakoutCountElement = document.getElementById('breakout-count');
            monitoredCountElement = document.getElementById('monitored-count');
        }
        
        // Initialize the application
        async function initializeApp() {
            addDebugEntry("System initialized. Starting data validation...", "info");
            statusMessage.textContent = "Loading real-time cryptocurrency data...";
            
            try {
                // Initialize charts
                initializeCharts();
                
                // Fetch initial data
                await fetchMarketData();
                
                // Set up periodic updates
                startUpdateCycle();
                
                statusMessage.textContent = "System operational. Monitoring markets...";
                healthBar.style.backgroundColor = "#2ecc71";
                healthText.textContent = "Optimal";
                
            } catch (error) {
                console.error("Initialization error:", error);
                addDebugEntry(`Initialization failed: ${error.message}`, "error");
                statusMessage.textContent = "Initialization failed: " + error.message;
                healthBar.style.backgroundColor = "#e74c3c";
                healthText.textContent = "Error";
                
                // Retry after 10 seconds
                setTimeout(initializeApp, 10000);
            }
        }
        
        // Initialize charts
        function initializeCharts() {
            // Sentiment Chart
            const sentimentCtx = document.getElementById('sentiment-chart');
            if (sentimentCtx) {
                charts.sentiment = new Chart(sentimentCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Bullish', 'Neutral', 'Bearish'],
                        datasets: [{
                            data: [60, 25, 15],
                            backgroundColor: ['#2ecc71', '#f39c12', '#e74c3c'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#e6e6e6',
                                    font: {
                                        size: 12
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Dominance Chart
            const dominanceCtx = document.getElementById('dominance-chart');
            if (dominanceCtx) {
                charts.dominance = new Chart(dominanceCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: ['Bitcoin', 'Ethereum', 'Other Top 10', 'Rest'],
                        datasets: [{
                            data: [46.8, 18.2, 22.5, 12.5],
                            backgroundColor: ['#2ecc71', '#3498db', '#9b59b6', '#e74c3c'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#e6e6e6',
                                    font: {
                                        size: 12
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Fetch market data from CoinGecko API
        async function fetchMarketData() {
            try {
                addDebugEntry("Fetching market data from CoinGecko API...", "info");
                
                // Use CoinGecko API to get market data
                const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false&price_change_percentage=1h%2C24h%2C7d');
                
                if (!response.ok) {
                    throw new Error('Failed to fetch market data: ' + response.status);
                }
                
                coinData = await response.json();
                
                if (!coinData || !Array.isArray(coinData) || coinData.length === 0) {
                    throw new Error('Invalid data received from API');
                }
                
                addDebugEntry(`Successfully fetched data for ${coinData.length} coins`, "info");
                
                // Update the UI
                updateDashboard();
                
                // Update last update time
                const now = new Date();
                lastUpdateElement.textContent = now.toLocaleTimeString();
                
                // Update API status
                apiStatusElement.textContent = "Live";
                apiStatusElement.className = "stat-value positive";
                
                return true;
                
            } catch (error) {
                console.error("Data fetch error:", error);
                addDebugEntry(`Data fetch failed: ${error.message}`, "error");
                statusMessage.textContent = "Data fetch failed: " + error.message;
                
                // Update API status
                apiStatusElement.textContent = "Error";
                apiStatusElement.className = "stat-value negative";
                
                // Retry after 5 seconds
                setTimeout(fetchMarketData, 5000);
                return false;
            }
        }
        
        // Update the dashboard with processed data
        function updateDashboard() {
            // Update market stats
            updateMarketStats();
            
            // Update ticker
            updateTicker();
            
            // Update breakout predictions based on real data
            updateBreakoutPredictions();
            
            // Update gainers and losers tables
            updateGainersLosers();
            
            // Update monitored coins table
            updateMonitoredCoins();
            
            // Update charts
            updateCharts();
        }
        
        // Update market statistics
        function updateMarketStats() {
            // Calculate total market cap and volume
            const totalMarketcap = coinData.reduce((sum, coin) => sum + (coin.market_cap || 0), 0);
            const totalVolume = coinData.reduce((sum, coin) => sum + (coin.total_volume || 0), 0);
            
            // Format numbers
            totalMarketcapElement.textContent = formatCurrency(totalMarketcap);
            totalVolumeElement.textContent = formatCurrency(totalVolume);
            
            // Get BTC dominance
            const btc = coinData.find(coin => coin.symbol === 'btc');
            if (btc && btc.market_cap) {
                const btcDominance = (btc.market_cap / totalMarketcap) * 100;
                btcDominanceElement.textContent = `${btcDominance.toFixed(1)}%`;
            }
            
            // Update active coins count
            activeCoinsElement.textContent = coinData.length.toLocaleString();
        }
        
        // Update the ticker with crypto data
        function updateTicker() {
            if (!tickerElement) return;
            
            tickerElement.innerHTML = '';
            
            coinData.forEach(coin => {
                const tickerItem = document.createElement('div');
                tickerItem.className = 'ticker-item';
                
                tickerItem.innerHTML = `
                    <span class="ticker-symbol">${coin.symbol ? coin.symbol.toUpperCase() : 'N/A'}</span>
                    <span class="ticker-price">${formatCurrency(coin.current_price)}</span>
                    <span class="ticker-change ${coin.price_change_percentage_24h >= 0 ? 'positive' : 'negative'}">
                        ${formatPercentage(coin.price_change_percentage_24h / 100)}
                    </span>
                `;
                
                tickerElement.appendChild(tickerItem);
            });
        }
        
        // Update breakout predictions using real data analysis
        function updateBreakoutPredictions() {
            if (!breakoutContainer) return;
            
            breakoutContainer.innerHTML = '';
            
            // Analyze real data for breakout patterns
            const predictions = analyzeBreakoutPatterns();
            
            // Update counter
            breakoutCountElement.textContent = `${predictions.length} predicted`;
            
            if (predictions.length === 0) {
                breakoutContainer.innerHTML = '<div class="ai-thinking">No strong breakout patterns detected at this time. Monitoring markets...</div>';
                return;
            }
            
            predictions.forEach(prediction => {
                const predictionElement = document.createElement('div');
                predictionElement.className = prediction.type === 'bullish' ? 'breakout-prediction' : 'bearish-prediction';
                
                predictionElement.innerHTML = `
                    <div class="prediction-header">
                        <div class="prediction-title">
                            <img src="${prediction.image}" alt="${prediction.name}" class="crypto-icon">
                            ${prediction.name} (${prediction.symbol.toUpperCase()}) - ${prediction.type.toUpperCase()} BREAKOUT
                        </div>
                        <div class="prediction-confidence" style="background: ${getConfidenceColor(prediction.confidence)}">
                            ${(prediction.confidence * 100).toFixed(0)}% Confidence
                        </div>
                    </div>
                    <div class="ai-thinking">${prediction.analysis}</div>
                    <div class="prediction-details">
                        <div class="prediction-card">
                            <div class="prediction-card-title">Current Price</div>
                            <div class="prediction-card-value">${formatCurrency(prediction.current_price)}</div>
                        </div>
                        <div class="prediction-card">
                            <div class="prediction-card-title">24h Change</div>
                            <div class="prediction-card-value ${prediction.price_change_24h >= 0 ? 'positive' : 'negative'}">${formatPercentage(prediction.price_change_24h / 100)}</div>
                        </div>
                        <div class="prediction-card">
                            <div class="prediction-card-title">Volume/MCap Ratio</div>
                            <div class="prediction-card-value">${(prediction.volume_ratio * 100).toFixed(2)}%</div>
                        </div>
                        <div class="prediction-card">
                            <div class="prediction-card-title">Recommended Action</div>
                            <div class="prediction-card-value">${prediction.recommendation}</div>
                        </div>
                    </div>
                `;
                
                breakoutContainer.appendChild(predictionElement);
            });
        }
        
        // Analyze real data for breakout patterns
        function analyzeBreakoutPatterns() {
            const predictions = [];
            
            // Analyze each coin for potential breakouts based on real data
            coinData.forEach(coin => {
                // Skip if essential data is missing
                if (!coin.market_cap || !coin.total_volume || !coin.price_change_percentage_24h) return;
                
                // Calculate volume to market cap ratio
                const volume_ratio = coin.total_volume / coin.market_cap;
                
                // Determine if this coin shows breakout patterns
                if (volume_ratio > 0.05 && Math.abs(coin.price_change_percentage_24h) > 7) {
                    const isBullish = coin.price_change_percentage_24h > 0;
                    // Confidence based on how extreme the values are
                    const confidence = Math.min(0.99, 0.7 + (volume_ratio * 2) + (Math.abs(coin.price_change_percentage_24h) / 100));
                    
                    const prediction = {
                        id: coin.id,
                        name: coin.name,
                        symbol: coin.symbol,
                        image: coin.image,
                        current_price: coin.current_price,
                        price_change_24h: coin.price_change_percentage_24h,
                        type: isBullish ? 'bullish' : 'bearish',
                        confidence: confidence,
                        volume_ratio: volume_ratio,
                        analysis: generateAIAnalysis(coin, isBullish, volume_ratio),
                        recommendation: isBullish ? 
                            `Consider buying, target ${formatCurrency(coin.current_price * 1.15)} in 3-5 days` : 
                            `Consider selling, potential drop to ${formatCurrency(coin.current_price * 0.85)}`
                    };
                    
                    predictions.push(prediction);
                }
            });
            
            // Sort by confidence and return top 3
            return predictions.sort((a, b) => b.confidence - a.confidence).slice(0, 3);
        }
        
        // Generate AI analysis text based on real data
        function generateAIAnalysis(coin, isBullish, volume_ratio) {
            const patterns = [];
            
            if (volume_ratio > 0.1) {
                patterns.push("extremely high volume relative to market cap");
            } else if (volume_ratio > 0.05) {
                patterns.push("high volume relative to market cap");
            }
            
            if (coin.price_change_percentage_24h > 15) {
                patterns.push("very strong price momentum");
            } else if (coin.price_change_percentage_24h > 7) {
                patterns.push("strong price momentum");
            }
            
            if (patterns.length > 0) {
                return `Showing ${patterns.join(" and ")}. ${isBullish ? 'Bullish' : 'Bearish'} breakout pattern detected.`;
            }
            
            return `Significant price movement detected with supporting volume. ${isBullish ? 'Bullish' : 'Bearish'} momentum building.`;
        }
        
        // Get color for confidence level
        function getConfidenceColor(confidence) {
            if (confidence > 0.85) return 'rgba(46, 204, 113, 0.3)';
            if (confidence > 0.7) return 'rgba(241, 196, 15, 0.3)';
            return 'rgba(231, 76, 60, 0.3)';
        }
        
        // Update gainers and losers tables
        function updateGainersLosers() {
            if (!gainersBody || !losersBody) return;
            
            // Sort by price change percentage
            const sortedData = [...coinData].sort((a, b) => 
                (b.price_change_percentage_24h || 0) - (a.price_change_percentage_24h || 0)
            );
            
            // Get top 10 gainers and losers
            const topGainers = sortedData.slice(0, 10);
            const topLosers = sortedData.slice(-10).reverse();
            
            // Update counters
            gainersCountElement.textContent = `${topGainers.length} coins`;
            losersCountElement.textContent = `${topLosers.length} coins`;
            
            // Update gainers table
            gainersBody.innerHTML = '';
            topGainers.forEach(coin => {
                const row = document.createElement('tr');
                
                // Format values
                const formattedPrice = formatCurrency(coin.current_price);
                const formattedChange = formatPercentage((coin.price_change_percentage_24h || 0) / 100);
                const formattedVolume = formatLargeNumber(coin.total_volume);
                
                row.innerHTML = `
                    <td>
                        <img src="${coin.image}" alt="${coin.name}" class="crypto-icon">
                        ${coin.name}
                    </td>
                    <td>${formattedPrice}</td>
                    <td class="positive">${formattedChange}</td>
                    <td>$${formattedVolume}</td>
                `;
                
                gainersBody.appendChild(row);
            });
            
            // Update losers table
            losersBody.innerHTML = '';
            topLosers.forEach(coin => {
                const row = document.createElement('tr');
                
                // Format values
                const formattedPrice = formatCurrency(coin.current_price);
                const formattedChange = formatPercentage((coin.price_change_percentage_24h || 0) / 100);
                const formattedVolume = formatLargeNumber(coin.total_volume);
                
                row.innerHTML = `
                    <td>
                        <img src="${coin.image}" alt="${coin.name}" class="crypto-icon">
                        ${coin.name}
                    </td>
                    <td>${formattedPrice}</td>
                    <td class="negative">${formattedChange}</td>
                    <td>$${formattedVolume}</td>
                `;
                
                losersBody.appendChild(row);
            });
        }
        
        // Update monitored coins table
        function updateMonitoredCoins() {
            if (!monitoredBody) return;
            
            // Filter for monitored coins
            const monitoredData = coinData.filter(coin => 
                monitoredCoins.includes(coin.id) || (coin.symbol && monitoredCoins.includes(coin.symbol))
            );
            
            // Update counter
            monitoredCountElement.textContent = `${monitoredData.length} coins`;
            
            monitoredData.forEach(coin => {
                const row = document.createElement('tr');
                
                // Format values
                const formattedPrice = formatCurrency(coin.current_price);
                const formattedChange = formatPercentage((coin.price_change_percentage_24h || 0) / 100);
                const formattedMarketcap = formatLargeNumber(coin.market_cap);
                const formattedVolume = formatLargeNumber(coin.total_volume);
                
                row.innerHTML = `
                    <td>
                        <img src="${coin.image}" alt="${coin.name}" class="crypto-icon">
                        ${coin.name} (${coin.symbol ? coin.symbol.toUpperCase() : 'N/A'})
                    </td>
                    <td>${formattedPrice}</td>
                    <td class="${(coin.price_change_percentage_24h || 0) >= 0 ? 'positive' : 'negative'}">
                        ${formattedChange}
                    </td>
                    <td>$${formattedMarketcap}</td>
                    <td>$${formattedVolume}</td>
                `;
                
                monitoredBody.appendChild(row);
            });
        }
        
        // Update charts with current data
        function updateCharts() {
            // Update sentiment chart with real data
            const bullishCount = coinData.filter(coin => (coin.price_change_percentage_24h || 0) > 5).length;
            const bearishCount = coinData.filter(coin => (coin.price_change_percentage_24h || 0) < -5).length;
            const neutralCount = coinData.length - bullishCount - bearishCount;
            
            const bullishPercentage = (bullishCount / coinData.length) * 100;
            const bearishPercentage = (bearishCount / coinData.length) * 100;
            const neutralPercentage = (neutralCount / coinData.length) * 100;
            
            if (charts.sentiment) {
                charts.sentiment.data.datasets[0].data = [bullishPercentage, neutralPercentage, bearishPercentage];
                charts.sentiment.update();
            }
            
            // Update dominance chart with real data
            const btc = coinData.find(coin => coin.symbol === 'btc');
            const eth = coinData.find(coin => coin.symbol === 'eth');
            
            if (btc && eth && charts.dominance) {
                const totalMarketcap = coinData.reduce((sum, coin) => sum + (coin.market_cap || 0), 0);
                const btcDominance = (btc.market_cap / totalMarketcap) * 100;
                const ethDominance = (eth.market_cap / totalMarketcap) * 100;
                
                // Get top 10 without BTC and ETH
                const top10WithoutBtcEth = coinData
                    .filter(coin => coin.symbol !== 'btc' && coin.symbol !== 'eth')
                    .slice(0, 8);
                
                const top10Dominance = top10WithoutBtcEth.reduce((sum, coin) => sum + (coin.market_cap || 0), 0) / totalMarketcap * 100;
                const restDominance = 100 - btcDominance - ethDominance - top10Dominance;
                
                charts.dominance.data.datasets[0].data = [
                    btcDominance, 
                    ethDominance, 
                    top10Dominance, 
                    restDominance
                ];
                charts.dominance.update();
            }
        }
        
        // Add entry to debug console
        function addDebugEntry(message, type = "info") {
            if (!debugConsole) return;
            
            const now = new Date();
            const timestamp = now.toTimeString().split(' ')[0];
            
            const entry = document.createElement('div');
            entry.className = 'debug-entry';
            
            entry.innerHTML = `
                <span class="debug-timestamp">[${timestamp}]</span>
                <span class="debug-${type}">${message}</span>
            `;
            
            debugConsole.appendChild(entry);
            debugConsole.scrollTop = debugConsole.scrollHeight;
            
            // Keep only the last 20 entries
            const entries = debugConsole.querySelectorAll('.debug-entry');
            if (entries.length > 20) {
                debugConsole.removeChild(entries[0]);
            }
        }
        
        // Start the periodic update cycle
        function startUpdateCycle() {
            updateTimer = 60;
            updateCountdownElement.textContent = `${updateTimer}s`;
            
            updateInterval = setInterval(() => {
                updateTimer--;
                updateCountdownElement.textContent = `${updateTimer}s`;
                
                if (updateTimer <= 0) {
                    updateTimer = 60;
                    fetchMarketData();
                }
            }, 1000);
        }
        
        // Utility functions
        function formatCurrency(value) {
            if (!value && value !== 0) return '$0.00';
            if (value < 1) {
                return '$' + value.toFixed(4);
            }
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }
        
        function formatPercentage(value) {
            if (!value && value !== 0) return '0.00%';
            const formatted = new Intl.NumberFormat('en-US', {
                style: 'percent',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
            
            return value >= 0 ? '+' + formatted : formatted;
        }
        
        function formatLargeNumber(value) {
            if (!value && value !== 0) return '0';
            if (value >= 1e9) {
                return (value / 1e9).toFixed(2) + 'B';
            } else if (value >= 1e6) {
                return (value / 1e6).toFixed(2) + 'M';
            } else if (value >= 1e3) {
                return (value / 1e3).toFixed(2) + 'K';
            }
            return value.toFixed(2);
        }
    </script>
</body>
</html>
